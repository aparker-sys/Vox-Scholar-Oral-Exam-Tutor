import{r as c,j as e}from"./index-CXUHKOq9.js";const js="oralExamFolders",ws=1,V="items";function we(){return new Promise((t,a)=>{const n=indexedDB.open(js,ws);n.onerror=()=>a(n.error),n.onsuccess=()=>t(n.result),n.onupgradeneeded=o=>{const i=o.target.result;if(!i.objectStoreNames.contains(V)){const l=i.createObjectStore(V,{keyPath:"id"});l.createIndex("subject","subject",{unique:!1}),l.createIndex("subject_subfolder",["subject","subfolder"],{unique:!1})}}})}async function gs(){const t=await we();return new Promise((a,n)=>{const o=t.transaction(V,"readonly"),l=o.objectStore(V).getAll();l.onsuccess=()=>a(l.result||[]),l.onerror=()=>n(l.error),o.oncomplete=()=>t.close()})}async function Ns(){const t=await gs(),a=new Set(t.map(n=>n.subject).filter(Boolean));return Array.from(a).sort()}async function Pt(t){const a=await we();return new Promise((n,o)=>{const i=a.transaction(V,"readonly"),u=i.objectStore(V).index("subject").getAll(t);u.onsuccess=()=>n(u.result||[]),u.onerror=()=>o(u.error),i.oncomplete=()=>a.close()})}async function Ut(t){const a=await we();return new Promise((n,o)=>{const i=a.transaction(V,"readwrite"),l=i.objectStore(V),r={id:t.id||"item_"+Date.now()+"_"+Math.random().toString(36).slice(2),subject:t.subject,subfolder:t.subfolder||"",name:t.name,type:t.type,tags:t.tags||[],content:t.content,mimeType:t.mimeType||null,size:t.size||null,createdAt:t.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},u=l.put(r);u.onsuccess=()=>n(r.id),u.onerror=()=>o(u.error),i.oncomplete=()=>a.close()})}async function qt(t){const a=await we();return new Promise((n,o)=>{const i=a.transaction(V,"readonly"),r=i.objectStore(V).get(t);r.onsuccess=()=>n(r.result),r.onerror=()=>o(r.error),i.oncomplete=()=>a.close()})}async function vs(t,a){const n=await qt(t);if(!n)return null;const o={...n,...a,updatedAt:new Date().toISOString()};return!("content"in a)&&n.content!==void 0&&(o.content=n.content),await Ut(o),o.id}async function Ss(t){const a=await we();return new Promise((n,o)=>{const i=a.transaction(V,"readwrite"),r=i.objectStore(V).delete(t);r.onsuccess=()=>n(),r.onerror=()=>o(r.error),i.oncomplete=()=>a.close()})}const oe="",Dt="vox_scholar_token",f={lastSession:"oralExam_lastSession",sessionHistory:"oralExam_sessionHistory",weakAreas:"oralExam_weakAreas",examDate:"oralExam_examDate",focusToday:"oralExam_focusToday",customSubjects:"oralExam_customSubjects",subjectRenames:"oralExam_subjectRenames",charlotteVoice:"oralExam_charlotteVoice"};let M=!1,Ke=null;const K={};function ae(){if(Ke)return Ke;try{return localStorage.getItem(Dt)}catch{return null}}function ks(t){Ke=t;try{t||localStorage.removeItem(Dt)}catch{}}function Mt(){ks(null),M=!1}async function A(t,a,n){const o={method:t,headers:{}},i=ae();i&&(o.headers.Authorization="Bearer "+i),n!==void 0&&(o.headers["Content-Type"]="application/json"),n!==void 0&&t!=="GET"&&(o.body=JSON.stringify(n));const l=await fetch(oe+a,o);if(l.status===401)throw Mt(),new Error("Unauthorized");if(!l.ok)throw new Error(l.statusText);return l.status===204||l.headers.get("content-length")==="0"?null:l.json()}async function Cs(){try{await fetch(oe+"/api/health")}catch{return M=!1,{backendOk:!1}}try{const[t,a,n,o]=await Promise.all([A("GET","/api/last-session"),A("GET","/api/session-history"),A("GET","/api/weak-areas"),A("GET","/api/settings")]);return K[f.lastSession]=t,K[f.sessionHistory]=Array.isArray(a)?a:[],K[f.weakAreas]=Array.isArray(n)?n:[],K[f.examDate]=(o==null?void 0:o.examDate)??null,K[f.focusToday]=(o==null?void 0:o.focusToday)??null,K[f.customSubjects]=(o==null?void 0:o.customSubjects)??[],K[f.subjectRenames]=(o==null?void 0:o.subjectRenames)??{},M=!0,{backendOk:!0}}catch{return M=!1,{backendOk:!0}}}function Ts(t,a){try{const n=localStorage.getItem(t);return n?JSON.parse(n):a}catch{return a}}function Rs(t,a){try{localStorage.setItem(t,JSON.stringify(a))}catch{}}function q(t,a){return M&&t in K?K[t]:Ts(t,a)}function G(t,a){if(K[t]=a,!M){Rs(t,a);return}(async()=>{try{if(t===f.lastSession)await A("POST","/api/last-session",a);else if(t===f.sessionHistory)await A("POST","/api/session-history",a);else if(t===f.weakAreas)await A("POST","/api/weak-areas",a);else if(t===f.examDate||t===f.focusToday||t===f.customSubjects||t===f.subjectRenames){const n=await A("GET","/api/settings");t===f.examDate?await A("PUT","/api/settings",{...n,examDate:a}):t===f.focusToday?await A("PUT","/api/settings",{...n,focusToday:a}):t===f.customSubjects?await A("PUT","/api/settings",{...n,customSubjects:a}):await A("PUT","/api/settings",{...n,subjectRenames:a})}}catch{}})()}function Ct(){if(delete K[f.lastSession],!M){localStorage.removeItem(f.lastSession);return}fetch(oe+"/api/last-session",{method:"DELETE",headers:ae()?{Authorization:"Bearer "+ae()}:{}}).catch(()=>{})}async function Oe(t){return M?await A("GET","/api/items?subject="+encodeURIComponent(t))||[]:Pt(t)}async function Tt(){return M?await A("GET","/api/items/subjects")||[]:Ns()}async function Rt(t){if(!M)return qt(t);const a=await A("GET","/api/items/"+encodeURIComponent(t));if(!a)return null;if(a.type==="file"&&a.content){const n=ae(),i=await(await fetch(oe+"/api/items/"+encodeURIComponent(t)+"/download",{headers:n?{Authorization:"Bearer "+n}:{}})).arrayBuffer();a.content=i}return a}async function je(t){if(!M)return Ut(t);if(t.type==="file"&&(t.content instanceof ArrayBuffer||t.content instanceof Blob)){const o=t.content instanceof Blob?t.content:new Blob([t.content]),i=new FormData;i.append("subject",t.subject||""),i.append("subfolder",t.subfolder||""),i.append("name",t.name||"file"),i.append("type","file"),i.append("file",o,t.name||"file");const l=ae(),r=await fetch(oe+"/api/items",{method:"POST",body:i,headers:l?{Authorization:"Bearer "+l}:{}}),u=await r.json();if(r.status===401)throw Mt(),new Error("Unauthorized");if(!r.ok)throw new Error(u.error||"Upload failed");return u.id}const a={subject:t.subject,subfolder:t.subfolder||"",name:t.name,type:t.type||"note",content:t.type==="note"?t.content:void 0};return(await A("POST","/api/items",a)).id}async function We(t,a){if(!M)return vs(t,a);await A("PATCH","/api/items/"+encodeURIComponent(t),a)}async function At(t){if(!M)return Ss(t);await A("DELETE","/api/items/"+encodeURIComponent(t))}async function Ht(t,a=null){const n=ae(),o=await fetch(oe+"/api/tts",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:"Bearer "+n}:{}},body:JSON.stringify({text:String(t).trim(),...a?{voice:a}:{}})});if(o.status===503)try{if((await o.json()).code==="TTS_NOT_CONFIGURED")return null}catch{}if(!o.ok){let i=o.statusText;try{const l=await o.json();l.detail?i=l.detail:l.error&&(i=l.error)}catch{}throw new Error(`TTS ${o.status}: ${i}`)}return o.blob()}async function As(t,a=[]){const n=ae(),o=await fetch(oe+"/api/chat",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:"Bearer "+n}:{}},body:JSON.stringify({message:String(t).trim(),history:a})});if(o.status===503&&(await o.json().catch(()=>({}))).code==="CHAT_NOT_CONFIGURED")return null;if(!o.ok)throw new Error("Chat failed");return(await o.json()).reply??""}async function Is(t){if(!M){const o=await Pt(t),i=new Set(o.map(l=>l.subfolder||"").filter(Boolean));return Array.from(i).sort()}const a=await Oe(t),n=new Set(a.map(o=>o.subfolder||"").filter(Boolean));return Array.from(n).sort()}const Z={"Thesis defense":[{question:"What is the central contribution of your thesis, and how does it differ from prior work?",keyPoints:["State the main claim or finding in one sentence","Briefly contrast with 2â€“3 key prior approaches","Explain what makes your contribution novel"]},{question:"How would you defend the validity of your methodology?",keyPoints:["Justify why this method was appropriate for the research question","Discuss limitations and how you mitigated them","Mention triangulation or validation if applicable"]},{question:"What are the main limitations of your work?",keyPoints:["Acknowledge 2â€“3 genuine limitations","Explain the impact on conclusions","Suggest future work that could address them"]}],"Clinical case":[{question:"A 45-year-old presents with acute chest pain. Walk through your differential and initial approach.",keyPoints:["Rule out life-threatening causes first (ACS, PE, aortic dissection)","Take focused history: onset, radiation, associated symptoms","Order appropriate initial workup (ECG, troponin, CXR)"]},{question:"A child presents with fever and rash. How do you approach the diagnosis?",keyPoints:["Assess severity and need for urgent intervention","Characterize the rash (macular, papular, distribution, timing)","Consider infectious vs non-infectious causes"]}],"Interview prep":[{question:"Tell me about a time you faced a significant setback. How did you respond?",keyPoints:["Use the STAR method (Situation, Task, Action, Result)","Focus on what you learned, not blame","End with a positive outcome or growth"]},{question:"Why do you want this role, and why are you a strong fit?",keyPoints:["Connect your values and goals to the organization","Highlight 2â€“3 specific strengths with examples","Show enthusiasm without overselling"]}],"Teaching demo":[{question:"Explain a complex concept (e.g., photosynthesis, supply and demand) as if to a beginner.",keyPoints:["Start with the big picture, then narrow down","Use analogies or everyday examples","Check for understanding verbally"]},{question:"How would you handle a disruptive or disengaged student in class?",keyPoints:["Address the behavior privately when possible","Use non-punitive redirection","Consider underlying causes (boredom, confusion, personal issues)"]}],"Policy & ethics":[{question:"A colleague shares confidential information. How do you respond?",keyPoints:["Clarify boundaries and expectations of confidentiality","Escalate appropriately if policy or law is breached","Document and protect the interests of affected parties"]},{question:"You disagree with a supervisor's decision. How do you handle it?",keyPoints:["Express your view respectfully and with evidence","Listen to their reasoning","Accept the final decision while maintaining professionalism"]}]};function Es(t){const a=Math.floor(t/60),n=t%60;return`${a}:${n.toString().padStart(2,"0")}`}function W(t){if(t==null)return"";const a=document.createElement("div");return a.textContent=t,a.innerHTML}function Os(t){const a=[...t];for(let n=a.length-1;n>0;n--){const o=Math.floor(Math.random()*(n+1));[a[n],a[o]]=[a[o],a[n]]}return a}function It(t){const a=new Date(t),n=new Date;a.setHours(0,0,0,0),n.setHours(0,0,0,0);const o=Math.ceil((a-n)/(1e3*60*60*24));return o<0?{label:"Exam date passed",value:`${Math.abs(o)} days ago`}:o===0?{label:"Exam is today",value:"Good luck!"}:o===1?{label:"Exam tomorrow",value:"1 day"}:{label:"Days until exam",value:`${o} days`}}function _s(t,a){const n=t(a.sessionHistory,[])||[],o=n.length,i={};n.forEach(y=>{i[y.topic]=(i[y.topic]||0)+1});const l=Object.keys(i).length===0?null:Object.entries(i).sort((y,m)=>m[1]-y[1])[0][0],r=new Set(n.map(y=>(y.date||"").slice(0,10)).filter(Boolean)),u=Array.from(r).sort().reverse();let j=0;if(u.length>0){const y=u[0];for(let m=0;m<365;m++){const b=new Date(y);b.setDate(b.getDate()-m);const w=b.toISOString().slice(0,10);if(r.has(w))j++;else break}}return{sessionsCompleted:o,averageScore:null,currentStreak:j,mostPracticed:l}}let ue=null;const Ls=["samantha","karen","victoria","moira","tessa","fiona","alice","luciana","linda","susan","laura","zira","catherine","claire","emily","female","woman","google uk english female","microsoft zira","google us english"],Ps=["alex","daniel","ralph","bruce","fred","tom","david","mark","paul","male","man","google uk english male","microsoft david"];function Et(t){const a=(t.name||"").toLowerCase(),n=(t.voiceURI||"").toLowerCase(),o=a+" "+n;return Ls.some(i=>o.includes(i))?"Female":Ps.some(i=>o.includes(i))?"Male":"Other"}function Us(){if(typeof window>"u"||!window.speechSynthesis)return[];const t=window.speechSynthesis.getVoices(),a="en",n=t.filter(r=>r.lang.startsWith(a)),i=(n.length?n:t).map(r=>({id:r.voiceURI||r.name,label:`${Et(r)} â€” ${r.name}`,voice:r,gender:Et(r)})),l={Female:0,Male:1,Other:2};return i.sort((r,u)=>l[r.gender]-l[u.gender]||r.label.localeCompare(u.label)),i}function Ye(){if(typeof window>"u"||!window.speechSynthesis)return null;const t=window.speechSynthesis.getVoices();if(!t.length)return null;const a=q(f.charlotteVoice,null);if(a){const l=t.find(r=>(r.voiceURI||r.name)===a);if(l)return l}if(ue)return ue;const n=["Samantha","Karen","Victoria","Google US English","Microsoft Zira","natural","premium","enhanced"],o=t.filter(l=>l.lang.startsWith("en")),i=o.length?o:t;for(const l of n){const r=i.find(u=>u.name.includes(l)||u.voiceURI&&u.voiceURI.toLowerCase().includes(l));if(r)return ue=r,r}return ue=i[0]||t[0],ue}let Ot=!1;function qs(){typeof window>"u"||!window.speechSynthesis||Ot||(Ot=!0,window.speechSynthesis.getVoices(),window.speechSynthesis.onvoiceschanged=()=>{ue=null,Ye()})}const _t=[.98,1,1.02,1.01],Ds=[.88,.91,.89,.92];function Qe(t,a=0){const n=a%_t.length;t.rate=Ds[n],t.pitch=_t[n],t.volume=1;const o=Ye();o&&(t.voice=o)}function Je(t){const a=t.trim();if(!a)return[];const n=a.split(new RegExp("(?<=[.!?])\\s+")).filter(Boolean);return n.length<=1?[a]:n}function Bt(t,{onStart:a,onEnd:n}){if(typeof window>"u"||!window.speechSynthesis||!(t!=null&&t.trim()))return;window.speechSynthesis.cancel();const o=Je(t);if(o.length===0)return;let i=0;function l(){if(i>=o.length){n==null||n();return}const r=new SpeechSynthesisUtterance(o[i]);Qe(r,i),i===0&&(r.onstart=a),r.onend=()=>{i++,l()},r.onerror=()=>{i++,l()},window.speechSynthesis.speak(r)}l()}function Ms(t,a){var r;if(typeof window>"u"||!window.speechSynthesis)return;window.speechSynthesis.cancel();let n=null;if(t&&Array.isArray(a)){const u=a.find(j=>j.id===t);u!=null&&u.voice&&(n=u.voice)}n||(n=Ye());const i=`Hi, I'm ${((r=n==null?void 0:n.name)==null?void 0:r.trim())||"Charlotte"}. This is how I'll sound when I help you practice for your oral exams.`,l=new SpeechSynthesisUtterance(i);l.rate=.92,l.pitch=1.02,l.volume=1,n&&(l.voice=n),window.speechSynthesis.speak(l)}function Hs(){const[t,a]=c.useState([]);return c.useEffect(()=>{if(typeof window>"u"||!window.speechSynthesis)return;function n(){a(Us())}return n(),window.speechSynthesis.onvoiceschanged=n,()=>{window.speechSynthesis.onvoiceschanged=null}},[]),{voiceOptions:t}}function Bs(){const[t,a]=c.useState(!1),n=c.useRef(null),o=c.useRef(null);return c.useEffect(()=>()=>{o.current&&URL.revokeObjectURL(o.current),n.current&&n.current.pause()},[]),{speak:c.useCallback(async l=>{const r=l==null?void 0:l.trim();if(!r)return;const u=typeof window<"u"&&window.speechSynthesis,j=()=>{o.current&&(URL.revokeObjectURL(o.current),o.current=null),n.current&&(n.current.pause(),n.current.src="",n.current=null)};try{const b=await Ht(r);if(b){j();const w=URL.createObjectURL(b);o.current=w;const C=new Audio(w);n.current=C,C.onplay=()=>a(!0),C.onended=()=>{a(!1),j()},C.onerror=()=>{a(!1),j()},await C.play();return}}catch{}if(!u)return;if(Je(r).length>1)Bt(r,{onStart:()=>a(!0),onEnd:()=>a(!1)});else{window.speechSynthesis.cancel();const b=new SpeechSynthesisUtterance(r);Qe(b,0),b.onstart=()=>a(!0),b.onend=()=>a(!1),b.onerror=()=>a(!1),window.speechSynthesis.speak(b)}},[]),isSpeaking:t}}function _e(){return typeof window>"u"?!1:!!(window.SpeechRecognition||window.webkitSpeechRecognition)}function Lt(t,a){const[n,o]=c.useState(!1),i=c.useRef(null),l=c.useRef(t),r=c.useRef(a);l.current=t,r.current=a,c.useEffect(()=>{if(!_e())return;const y=window.SpeechRecognition||window.webkitSpeechRecognition,m=new y;return m.continuous=!1,m.interimResults=!1,m.lang="en-US",m.onresult=b=>{var N,T,_;const w=b.results[b.resultIndex],C=w!=null&&w.isFinal?(T=(N=w[0])==null?void 0:N.transcript)==null?void 0:T.trim():"";C&&((_=l.current)==null||_.call(l,C))},m.onend=()=>o(!1),m.onerror=b=>{var w;o(!1),b.error!=="aborted"&&((w=r.current)==null||w.call(r,b.error))},i.current=m,()=>{try{m.stop()}catch{}i.current=null}},[]);const u=c.useCallback(()=>{var y;if(!(!i.current||n))try{i.current.start(),o(!0)}catch(m){(y=r.current)==null||y.call(r,m.message||"Could not start listening")}},[n]),j=c.useCallback(()=>{if(!(!i.current||!n)){try{i.current.stop()}catch{}o(!1)}},[n]);return{supported:_e(),isListening:n,startListening:u,stopListening:j}}function Fs(t,a){const[n,o]=c.useState(!1),i=c.useRef(null),l=c.useRef(t),r=c.useRef(a);l.current=t,r.current=a,c.useEffect(()=>{if(!_e())return;const y=window.SpeechRecognition||window.webkitSpeechRecognition,m=new y;return m.continuous=!0,m.interimResults=!1,m.lang="en-US",m.onresult=b=>{var w,C;for(let N=b.resultIndex;N<b.results.length;N++){const T=b.results[N];if(T.isFinal&&((w=T[0])!=null&&w.transcript)){const _=T[0].transcript.trim();_&&((C=l.current)==null||C.call(l,_))}}},m.onend=()=>o(!1),m.onerror=b=>{var w;o(!1),b.error!=="aborted"&&((w=r.current)==null||w.call(r,b.error))},i.current=m,()=>{try{m.abort()}catch{}i.current=null}},[]);const u=c.useCallback(()=>{var y;if(!(!i.current||n))try{i.current.start(),o(!0)}catch(m){(y=r.current)==null||y.call(r,m.message||"Could not start listening")}},[n]),j=c.useCallback(()=>{if(i.current){try{i.current.stop()}catch{}o(!1)}},[]);return{supported:_e(),isListening:n,start:u,stop:j}}function Ee({onSpeak:t,className:a="",label:n="Your tutor",idleMessage:o="Tap to hear me",size:i="medium",isSpeaking:l}){const r=c.useRef(null),u=c.useRef(null),j=c.useRef(null),[y,m]=c.useState(!1),[b,w]=c.useState(!1),[C,N]=c.useState(""),T=c.useRef(null),_=c.useRef(0),I=l!==void 0?l:y;c.useEffect(()=>{const h=typeof window<"u"&&"speechSynthesis"in window&&"SpeechSynthesisUtterance"in window;return w(h),h&&qs(),()=>{j.current&&URL.revokeObjectURL(j.current),u.current&&u.current.pause()}},[]);const R=c.useCallback(async h=>{const x=h==null?void 0:h.trim();if(!x)return;const $=typeof window<"u"&&window.speechSynthesis,L=()=>{j.current&&(URL.revokeObjectURL(j.current),j.current=null),u.current&&(u.current.pause(),u.current.src="",u.current=null)};N("");try{const S=await Ht(x);if(S){L();const k=URL.createObjectURL(S);j.current=k;const p=new Audio(k);u.current=p,p.onplay=()=>m(!0),p.onended=()=>{m(!1),L()},p.onerror=()=>{m(!1),L()},await p.play(),console.info("[Charlotte TTS] Using backend (natural voice)"),t==null||t(h);return}N("TTS not configured on server"),console.warn("[Charlotte TTS] Backend returned no audio (503). Using browser voice.")}catch(S){const k=(S==null?void 0:S.message)||"Request failed";N(k.includes("429")?"Too many requestsâ€”wait a minute and try again.":k),console.warn("[Charlotte TTS] Backend failed:",k,"â€” using browser voice.")}if(!$)return;if(Je(x).length>1)Bt(x,{onStart:()=>m(!0),onEnd:()=>m(!1)});else{window.speechSynthesis.cancel();const S=new SpeechSynthesisUtterance(x);Qe(S,0),S.onstart=()=>m(!0),S.onend=()=>m(!1),S.onerror=()=>m(!1),window.speechSynthesis.speak(S)}t==null||t(h)},[b,t]);return c.useEffect(()=>{const h=r.current;if(!h)return;const x=h.getContext("2d");let $=0,L=0;const z=()=>{const S=Math.min(2,window.devicePixelRatio||1),k=h.getBoundingClientRect();$=k.width,L=k.height,h.width=$*S,h.height=L*S,x.setTransform(S,0,0,S,0,0)},Y=()=>{if(!r.current||!x)return;const S=h.getBoundingClientRect();(S.width!==$||S.height!==L)&&z();const k=S.width,p=S.height;if(k<=0||p<=0){T.current=requestAnimationFrame(Y);return}x.clearRect(0,0,k,p),_.current+=I?.12:.04;const v=_.current,Q=p/2,B=I?Math.min(18,8+10*(.5+.5*Math.sin(v*.5))):6,me=I?2.2:1.4,he=120;x.beginPath();for(let J=0;J<=he;J++){const re=J/he*k,Le=Q+B*Math.sin(J/he*Math.PI*me*2+v)+(I?2*Math.sin(J/he*4+v*1.5):0);J===0?x.moveTo(re,Le):x.lineTo(re,Le)}const pe=x.createLinearGradient(0,0,k,0);pe.addColorStop(0,"rgba(45, 157, 120, 0.35)"),pe.addColorStop(.5,"rgba(45, 157, 120, 0.85)"),pe.addColorStop(1,"rgba(45, 157, 120, 0.35)"),x.strokeStyle=pe,x.lineWidth=I?2.5:1.8,x.lineCap="round",x.lineJoin="round",x.stroke(),T.current=requestAnimationFrame(Y)};return z(),T.current=requestAnimationFrame(Y),()=>{T.current&&cancelAnimationFrame(T.current)}},[I]),c.useCallback(()=>{t||b&&R(o)},[b,R,o,t]),e.jsxs("div",{className:`voice-tutor voice-tutor--${i} ${a}`,role:"region","aria-label":n,children:[e.jsx("div",{className:"voice-tutor__wave-wrap",children:e.jsx("canvas",{ref:r,className:"voice-tutor__canvas",width:i==="small"?160:240,height:i==="small"?48:72,"aria-hidden":"true"})}),e.jsxs("div",{className:"voice-tutor__footer",children:[b&&e.jsx("p",{className:"voice-tutor__hint",children:I?"Speakingâ€¦":o}),C&&e.jsxs("p",{className:"voice-tutor__hint voice-tutor__hint--fallback",role:"status",children:["Using browser voice â€” ",C]}),!b&&e.jsx("p",{className:"voice-tutor__hint voice-tutor__hint--muted",children:"Voice not supported in this browser"})]})]})}const Vs=["home","subjects","performance","weak","settings","folder","library"],$s=["think","answer","feedback","complete"];function Zs(){const[t,a]=c.useState(!1),[n,o]=c.useState(!0),[i,l]=c.useState("home"),[r,u]=c.useState(null),[j,y]=c.useState(30),[m,b]=c.useState(120),[w,C]=c.useState(null),[N,T]=c.useState([]),[_,I]=c.useState([]),[R,h]=c.useState(0),[x,$]=c.useState(null),[L,z]=c.useState(""),[Y,S]=c.useState("subjects"),[k,p]=c.useState(null),[v,Q]=c.useState([]),[B,me]=c.useState(null),[he,pe]=c.useState(0),[J,re]=c.useState(0),[Le,Xe]=c.useState(""),[Ze,ge]=c.useState([]),[et,ce]=c.useState(""),[tt,Vt]=c.useState(""),[$t,st]=c.useState(!1),[nt,at]=c.useState(""),[Pe,ot]=c.useState(""),[ee,ie]=c.useState({open:!1,title:"",content:"",subfolder:""}),[zt,rt]=c.useState(!1),[Gt,ct]=c.useState(""),[Wt,it]=c.useState(!1),[Kt,Yt]=c.useState(""),[Qt,Ue]=c.useState(!1),[fe,Jt]=c.useState(""),[Xt,qe]=c.useState(!1),[Ne,lt]=c.useState({folder:"",title:"",content:""}),[Zt,dt]=c.useState(0),[F,ut]=c.useState({}),[De,se]=c.useState(null),[mt,Me]=c.useState(""),[ht,pt]=c.useState(!0),[He,ft]=c.useState(""),[bt,es]=c.useState([]),[le,yt]=c.useState(!1),[xt,ve]=c.useState(""),be=c.useRef(null),O=c.useRef(null),{speak:te,isSpeaking:H}=Bs(),{voiceOptions:jt}=Hs(),wt=c.useCallback(async s=>{const d=typeof s=="string"?s.trim():"";if(!(!d||le)){yt(!0),ve("");try{const g=await As(d,bt);g?(es(E=>[...E,{role:"user",content:d},{role:"assistant",content:g}].slice(-20)),ft(""),te(g)):ve("Chat isn't configured. Add OPENAI_API_KEY on the server.")}catch(g){ve(g.message||"Something went wrong.")}finally{yt(!1)}}},[bt,le,te]),{supported:ts,isListening:Be,startListening:ss}=Lt(wt,s=>ve(s||"Voice input failed.")),ns=c.useCallback(s=>{Xe(d=>(d?d+" ":"")+s)},[]);Lt(ns,()=>{});const Se=c.useRef(""),as=c.useCallback(s=>{ce(d=>{const g=d?d+" "+s:s;return Se.current=g,g})},[]),{supported:os,isListening:gt,start:Nt,stop:vt}=Fs(as,()=>{});c.useEffect(()=>{Se.current=et},[et]),c.useEffect(()=>{Cs().then(({backendOk:s})=>{o(s??!0),a(!0)})},[]),c.useEffect(()=>{if(!t)return;ut(q(f.subjectRenames,{})||{});const s=Object.keys(Z||{});Tt().then(d=>{const g=q(f.customSubjects,[])||[];Q([...new Set([...s,...d,...g])].sort())})},[t,i]);const P=c.useCallback(s=>{Vs.includes(s)&&l(s)},[]),ke=c.useCallback(()=>{!w||!N.length||G(f.lastSession,{topic:w,currentIndex:R,questionOrder:_,timestamp:Date.now()})},[w,N.length,R,_]),Ce=c.useCallback((s,d)=>{const g=q(f.sessionHistory,[])||[],E=[{topic:s,completed:d,date:new Date().toISOString()},...g].slice(0,20);G(f.sessionHistory,E)},[]),Fe=c.useCallback(()=>{const s=q(f.focusToday,null);return!s||typeof s!="object"?"":s.text||""},[]),rs=c.useCallback(s=>{const d=(s||"").trim();G(f.focusToday,{date:new Date().toISOString().slice(0,10),text:d})},[]),ye=c.useCallback(()=>q(f.weakAreas,[])||[],[]),cs=c.useCallback((s,d)=>{const g=ye();g.some(E=>E.topic===s&&E.question===d)||G(f.weakAreas,[{topic:s,question:d},...g].slice(0,30))},[ye]),is=c.useCallback(s=>{const d=ye();d.splice(s,1),G(f.weakAreas,d)},[ye]),ls=c.useCallback(()=>q(f.examDate,null),[]),St=c.useCallback(s=>{G(f.examDate,s||null)},[]),Ve=t?_s(q,f):{sessionsCompleted:0,currentStreak:0,mostPracticed:null},ne=t?q(f.lastSession,null):null,Te=t?q(f.sessionHistory,[])||[]:[],Re=t?ye():[],$e=t?ls():null,X=r&&$s.includes(r),ds=N.length>0?R/N.length*100:0,Ae=c.useCallback((s,d="subjects")=>{$(s),z(""),S(d||"subjects"),l("folder")},[]),xe=c.useRef(null),ze=c.useCallback(s=>{if(!Z[s])return;const d=[...Z[s]],g=Os(d.map((E,U)=>({...E,_idx:U})));C(s),T(g),I(g.map(E=>E._idx)),h(0),Xe(""),ge([]),ce(""),ke(),u("think"),xe.current=null},[ke]);c.useEffect(()=>{if(r!=="think"||!D||!N.length)return;const s=`${R}-${D.question}`;xe.current!==s&&(xe.current=s,te(D.question))},[r,R,D,N.length,te]);const us=c.useCallback(()=>{ce(""),u("answer"),re(Math.max(30,m)),Nt()},[m,Nt]),Ie=c.useCallback(()=>{vt();const s=Se.current;ge(d=>{const g=[...d];return g[R]=s,g}),ce(""),Se.current=""},[R,vt]);c.useEffect(()=>{if(r!=="answer")return;const s=Math.max(30,m);return re(s),O.current&&clearInterval(O.current),O.current=setInterval(()=>{re(d=>d<=1?(O.current&&clearInterval(O.current),O.current=null,0):d-1)},1e3),()=>{O.current&&clearInterval(O.current)}},[r,R,m]);const ms=c.useCallback(()=>{O.current&&(clearInterval(O.current),O.current=null),r==="answer"&&Ie(),u("feedback")},[r,Ie]),hs=c.useCallback(()=>{const s=R+1;h(s),s>=N.length?(Ct(),Ce(w,!0),Vt(`You completed ${N.length} question${N.length===1?"":"s"} on "${F[w]||w}". Great work.`),u("complete")):(ke(),xe.current=null,u("think"))},[R,N.length,w,F,ke,Ce]),Ge=c.useCallback(()=>{be.current&&clearInterval(be.current),O.current&&clearInterval(O.current),be.current=null,O.current=null,r==="answer"&&Ie(),Ct(),Ce(w||"Unknown",!1),u(null),C(null),T([]),h(0),l("home")},[w,r,Ce,Ie]),ps=c.useCallback(()=>{be.current&&clearInterval(be.current),O.current&&clearInterval(O.current),u(null),C(null),T([]),h(0),ge([]),ce(""),l("home")},[]),fs=c.useCallback(()=>{u(null),C(null),T([]),h(0),ge([]),ce(""),l("subjects")},[]),bs=c.useCallback(async s=>{if(p(s),s){const d=await Rt(s);ie({open:!0,title:(d==null?void 0:d.name)||"",content:(d==null?void 0:d.content)??"",subfolder:(d==null?void 0:d.subfolder)||""})}else ie({open:!0,title:"",content:"",subfolder:L||""})},[L]),de=c.useCallback(()=>{ie(s=>({...s,open:!1})),p(null)},[]),ys=c.useCallback(async()=>{const s=ee.title.trim(),d=ee.content,g=ee.subfolder.trim();s&&(k?await We(k,{name:s,content:d,subfolder:g}):await je({subject:x,name:s,type:"note",content:d,subfolder:g}),de(),dt(E=>E+1))},[ee,k,x,de]),xs=c.useCallback(async s=>{window.confirm("Delete this item?")&&(await At(s),k===s&&de(),l(d=>d))},[k,de]),D=N[R];return t?n?e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{className:"logo",onClick:()=>P("home"),children:"Vox Scholar"}),e.jsx("p",{className:"tagline",children:"Practice like the real thing"})]}),e.jsx("button",{type:"button",className:"btn-settings",onClick:()=>P("settings"),title:"Settings",children:"âš™"}),e.jsx("div",{className:`progress-bar ${X?"":"hidden"}`,"aria-hidden":"true",children:e.jsx("div",{className:"progress-fill",style:{width:`${ds}%`}})})]}),e.jsxs("main",{className:"main",children:[i==="home"&&!X&&e.jsxs("section",{className:"screen screen-home active",children:[e.jsx("div",{className:"home-cta",children:e.jsxs("button",{type:"button",className:"btn-cta-primary",onClick:()=>P("subjects"),children:[e.jsx("span",{className:"cta-label",children:"ðŸŽ¤ Start Mock Exam"}),e.jsx("span",{className:"cta-sublabel",children:"15-minute timed oral simulation"})]})}),e.jsxs("section",{className:"home-tile voice-tutor-tile",children:[e.jsx("h2",{className:"tile-title",children:"Charlotte â€” your voice tutor"}),e.jsxs("div",{className:"tile-body voice-tutor-tile-body",children:[e.jsx(Ee,{isSpeaking:H,label:"Charlotte, voice tutor",idleMessage:"Tap below to hear Charlotte say hello",size:"medium"}),e.jsx("div",{className:"voice-tutor-actions",children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>te("Hi, I'm Charlotte, your voice tutor. I'm so excited to help you learn and get ready for your oral exams. Whenever you're ready, start a mock exam or pick a subject to practiceâ€”I'm here to read questions and key points aloud. Let's do this!"),disabled:H,children:H?"Speakingâ€¦":"Hear Charlotteâ€™s welcome"})}),e.jsxs("div",{className:"charlotte-chat",children:[e.jsx("p",{className:"charlotte-chat-hint",children:"Ask Charlotte anythingâ€”type or tap the mic to talk; she'll reply and can read it aloud."}),ts&&e.jsx("div",{className:"charlotte-voice-input",children:e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm charlotte-mic-btn",onClick:ss,disabled:le||H||Be,title:"Talk to Charlotte","aria-label":Be?"Listeningâ€¦":"Talk to Charlotte",children:Be?"Listeningâ€¦":"ðŸŽ¤ Talk to Charlotte"})}),e.jsxs("form",{className:"charlotte-chat-form",onSubmit:s=>{s.preventDefault(),wt(He)},children:[e.jsx("input",{type:"text",className:"charlotte-chat-input",placeholder:"e.g. How do I stay calm in the exam?",value:He,onChange:s=>ft(s.target.value),disabled:le}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-sm",disabled:le||!He.trim(),children:le?"â€¦":"Ask Charlotte"})]}),xt&&e.jsx("p",{className:"charlotte-chat-error",children:xt})]})]})]}),e.jsxs("div",{className:"stats-bar",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:Ve.sessionsCompleted}),e.jsx("span",{className:"stat-label",children:"Sessions completed"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:"â€”"}),e.jsx("span",{className:"stat-label",children:"Average score"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:Ve.currentStreak}),e.jsx("span",{className:"stat-label",children:"Current streak"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value stat-subject",children:Ve.mostPracticed||"â€”"}),e.jsx("span",{className:"stat-label",children:"Most practiced"})]})]}),e.jsxs("div",{className:"home-two-col",children:[e.jsxs("div",{className:"home-left",children:[e.jsxs("section",{className:"home-tile home-continue",children:[e.jsx("h2",{className:"tile-title",children:"Continue Last Session"}),e.jsx("div",{className:"tile-body",children:ne&&Z[ne.topic]?e.jsxs("div",{className:"continue-content",children:[e.jsx("p",{className:"continue-topic",children:F[ne.topic]||ne.topic}),e.jsxs("p",{className:"continue-progress",children:["Question ",ne.currentIndex+1," of ",ne.questionOrder.length]}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>{const s=ne,d=Z[s.topic];C(s.topic),T(s.questionOrder.map(g=>({...d[g],_idx:g}))),I(s.questionOrder),h(s.currentIndex),u("think"),xe.current=null},children:"Continue"})]}):e.jsx("p",{className:"continue-empty",children:"No session in progress"})})]}),e.jsxs("section",{className:"home-tile home-start-exam",children:[e.jsx("h2",{className:"tile-title",children:"Start Exam"}),e.jsxs("div",{className:"tile-body",children:[e.jsx("p",{className:"start-exam-desc",children:"Pick a subject and run a timed practice session."}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>P("subjects"),children:"Start exam"})]})]}),e.jsxs("section",{className:"home-tile focus-today-panel",children:[e.jsx("h2",{className:"tile-title",children:"Focus Today"}),e.jsx("div",{className:"tile-body focus-today-body",children:$t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"focus-today-edit",children:[e.jsx("input",{type:"text",className:"focus-today-input",value:nt,onChange:s=>at(s.target.value),placeholder:"e.g. Cardiorespiratory system",maxLength:120}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>{rs(nt),st(!1)},children:"Save"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`focus-today-text ${Fe()?"":"empty"}`,children:Fe()||"Set your focus for today"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm focus-today-btn",onClick:()=>{st(!0),at(Fe())},children:"Edit focus"})]})})]}),e.jsxs("section",{className:"home-tile home-library",role:"button",tabIndex:0,onClick:()=>P("library"),onKeyDown:s=>(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),P("library")),children:[e.jsx("h2",{className:"tile-title",children:"Library"}),e.jsxs("div",{className:"tile-body",children:[e.jsx("p",{className:"library-desc",children:"Add files from your computer, create notes, and organize by class."}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:s=>(s.stopPropagation(),P("library")),children:"Open library"})]})]})]}),e.jsxs("div",{className:"home-right",children:[e.jsxs("section",{className:"home-tile home-performance",children:[e.jsx("h2",{className:"tile-title",children:"Recent Performance"}),e.jsxs("div",{className:"tile-body",children:[Te.length===0?e.jsx("p",{className:"performance-empty",children:"Complete a session to see stats"}):e.jsx("div",{className:"performance-preview",children:e.jsx("div",{className:"performance-stats",children:Object.entries(Te.slice(0,5).reduce((s,d)=>(s[d.topic]=(s[d.topic]||0)+1,s),{})).map(([s,d])=>e.jsxs("div",{className:"performance-row",children:[e.jsx("strong",{children:W(s)}),e.jsx("span",{children:d})]},s))})}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm tile-more",onClick:()=>P("performance"),children:"View details"})]})]}),e.jsxs("section",{className:"home-tile home-weak",children:[e.jsx("h2",{className:"tile-title",children:"Weak Areas"}),e.jsxs("div",{className:"tile-body",children:[Re.length===0?e.jsx("p",{className:"weak-empty",children:"Flag questions during practice"}):e.jsx("div",{className:"weak-preview",children:e.jsx("ul",{children:Re.slice(0,3).map((s,d)=>e.jsxs("li",{children:[W(F[s.topic]||s.topic),": ",W(s.question.slice(0,30)),s.question.length>30?"â€¦":""]},d))})}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm tile-more",onClick:()=>P("weak"),children:"View all"})]})]})]})]})]}),i==="subjects"&&!X&&e.jsxs("section",{className:"screen screen-subjects active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>P("home"),children:"â† Home"}),e.jsx("h2",{className:"screen-title",children:"Subjects"})]}),e.jsxs("div",{className:"session-settings",children:[e.jsxs("label",{className:"setting",children:[e.jsx("span",{children:"Think time (sec)"}),e.jsx("input",{type:"number",value:j,onChange:s=>y(Number(s.target.value)||30),min:5,max:120,step:5})]}),e.jsxs("label",{className:"setting",children:[e.jsx("span",{children:"Answer time (sec)"}),e.jsx("input",{type:"number",value:m,onChange:s=>b(Number(s.target.value)||120),min:30,max:600,step:30})]})]}),e.jsx("div",{className:"subject-grid",children:Object.keys(Z).map(s=>e.jsxs("div",{className:"subject-card",children:[e.jsx("span",{className:"subject-name",children:W(F[s]||s)}),e.jsxs("div",{className:"subject-card-actions",children:[e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>ze(s),children:"Practice"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>Ae(s),children:"Class"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-rename",onClick:()=>{se(s),Me(F[s]??s),pt(!0)},title:"Rename subject",children:"Rename"})]})]},s))})]}),i==="library"&&!X&&e.jsx(zs,{librarySubjects:v,setLibrarySubjects:Q,subjectRenames:F,openFolder:Ae,setLibraryPendingFiles:me,setLibraryAddFilesModalOpen:Ue,setLibraryNewNoteModalOpen:qe,setNewFolderModalOpen:it,navigate:P,getUniqueSubjects:Tt,getAllBySubject:Oe,loadStorage:q,saveStorage:G,STORAGE_KEYS:f,escapeHtml:W,QUESTIONS_BY_TOPIC:Z,onRenameSubject:s=>{se(s),Me(Z[s]?F[s]??s:s),pt(!!Z[s])}}),i==="folder"&&!X&&x&&e.jsx(Gs,{folderSubject:x,subjectRenames:F,folderSubfolderFilter:L,setFolderSubfolderFilter:z,folderBackRoute:Y,navigate:P,openNoteEditor:bs,openFolder:Ae,selectTopic:ze,getAllBySubject:Oe,getSubfolders:Is,getItem:Rt,addItem:je,updateItem:We,deleteItem:At,setSubfolderModalOpen:rt,setNewSubfolderName:ct,escapeHtml:W,setRoute:l},Zt),i==="performance"&&!X&&e.jsxs("section",{className:"screen screen-performance active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>P("home"),children:"â† Home"}),e.jsx("h2",{className:"screen-title",children:"Recent Performance"})]}),e.jsx("div",{className:"performance-card-full",children:Te.length===0?e.jsx("p",{className:"performance-empty",children:"Complete a session to see your stats"}):e.jsx("div",{className:"performance-content-full",children:e.jsx("div",{className:"performance-stats",children:Object.entries(Te.slice(0,20).reduce((s,d)=>(s[d.topic]=(s[d.topic]||0)+1,s),{})).map(([s,d])=>e.jsxs("div",{className:"performance-row",children:[e.jsx("strong",{children:W(F[s]||s)}),e.jsxs("span",{children:[d," session",d>1?"s":""]})]},s))})})})]}),i==="weak"&&!X&&e.jsxs("section",{className:"screen screen-weak active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>P("home"),children:"â† Home"}),e.jsx("h2",{className:"screen-title",children:"Saved Weak Areas"})]}),e.jsx("div",{className:"weak-card-full",children:Re.length===0?e.jsx("p",{className:"weak-empty",children:"Flag questions during practice to build this list"}):e.jsx("ul",{className:"weak-list",children:Re.map((s,d)=>e.jsxs("li",{children:[e.jsxs("span",{children:[W(F[s.topic]||s.topic),": ",W(s.question.slice(0,50)),s.question.length>50?"â€¦":""]}),e.jsxs("span",{className:"weak-actions",children:[e.jsx("button",{type:"button",className:"btn btn-primary btn-sm weak-practice",onClick:()=>ze(s.topic),children:"Practice"}),e.jsx("button",{type:"button",className:"weak-remove",onClick:()=>is(d),children:"Ã—"})]})]},d))})})]}),i==="settings"&&!X&&e.jsxs("section",{className:"screen screen-settings active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>P("home"),children:"â† Home"}),e.jsx("h2",{className:"screen-title",children:"Settings"})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-subtitle",children:"Upcoming Exam"}),e.jsx("div",{className:"countdown-card",children:$e?e.jsxs("div",{className:"countdown-display",children:[e.jsx("p",{className:"countdown-label",children:It($e).label}),e.jsx("p",{className:"countdown-value",children:It($e).value}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>(St(null),ot("")),children:"Clear"})]}):e.jsxs("div",{className:"countdown-set",children:[e.jsx("label",{htmlFor:"examDate",children:"Exam date"}),e.jsx("input",{id:"examDate",type:"date",value:Pe,onChange:s=>ot(s.target.value)}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>Pe&&St(Pe),children:"Set"})]})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-subtitle",children:"Charlotteâ€™s voice"}),e.jsx("p",{className:"settings-note",children:"Choose a voice that matches how youâ€™d like Charlotte to sound. Names are labeled by the voiceâ€™s sex."}),e.jsxs("label",{className:"setting",children:[e.jsx("span",{children:"Voice"}),e.jsxs("select",{value:q(f.charlotteVoice,"")??"",onChange:s=>G(f.charlotteVoice,s.target.value||null),children:[e.jsx("option",{value:"",children:"Default (recommended)"}),jt.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]})]}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm settings-voice-try",onClick:()=>Ms(q(f.charlotteVoice,"")??"",jt),children:"Try this voice"})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{className:"settings-subtitle",children:"Session Defaults"}),e.jsx("p",{className:"settings-note",children:"Think and answer times are configured on the Subjects screen."})]})]}),r==="think"&&D&&e.jsxs("section",{className:"screen screen-think screen-session active",children:[e.jsx("p",{className:"phase-label",children:"Charlotte asks"}),e.jsxs("div",{className:"session-voice-tutor",children:[e.jsx(Ee,{isSpeaking:H,label:"Charlotte",idleMessage:"Listen for the question",size:"small"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>te(D.question),disabled:H,children:H?"Speakingâ€¦":"Hear question again"})]}),e.jsx("p",{className:"question-text",children:D.question}),e.jsxs("div",{className:"session-actions",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:us,children:"Start answering"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ge,children:"End session"})]})]}),r==="answer"&&D&&e.jsxs("section",{className:"screen screen-answer screen-session active",children:[e.jsx("p",{className:"phase-label",children:"Answer"}),e.jsx("p",{className:"question-text",children:D.question}),e.jsx("div",{className:`timer answer-timer ${J<=30?"warning":""}`,children:e.jsx("span",{className:"timer-value",children:Es(J)})}),e.jsx("div",{className:"answer-listening-area",children:os?e.jsxs("div",{className:`answer-listening-indicator ${gt?"active":""}`,children:[e.jsx("span",{className:"answer-listening-icon","aria-hidden":!0,children:"ðŸŽ¤"}),e.jsx("p",{className:"answer-listening-text",children:gt?"Charlotte is listeningâ€¦ Your response will be shown after the session.":"Listening will start when you press Start answering."})]}):e.jsx("p",{className:"answer-listening-fallback",children:"Voice capture is not supported in this browser. Use a supported browser to have your answer recorded."})}),e.jsxs("div",{className:"session-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:ms,children:"Next question"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ge,children:"End session"})]})]}),r==="feedback"&&D&&e.jsxs("section",{className:"screen screen-feedback screen-session active",children:[e.jsx("p",{className:"phase-label",children:"Key points to include"}),e.jsxs("div",{className:"session-voice-tutor session-voice-tutor--compact",children:[e.jsx(Ee,{isSpeaking:H,size:"small",idleMessage:"Hear key points"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>te("Key points to include: "+D.keyPoints.map((s,d)=>`${d+1}. ${s}`).join(". ")),disabled:H,children:H?"Speakingâ€¦":"Hear key points"})]}),e.jsx("p",{className:"question-text",children:D.question}),e.jsx("ul",{className:"key-points",children:D.keyPoints.map((s,d)=>e.jsx("li",{children:W(s)},d))}),e.jsxs("div",{className:"feedback-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>cs(w,D.question),children:"Flag as weak area"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:hs,children:"Continue"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:Ge,children:"End session"})]})]}),r==="complete"&&e.jsxs("section",{className:"screen screen-complete screen-session active",children:[e.jsx("h2",{children:"Session complete"}),e.jsxs("div",{className:"session-voice-tutor session-voice-tutor--compact",children:[e.jsx(Ee,{isSpeaking:H,size:"small",idleMessage:"Hear summary"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>te(tt),disabled:H,children:H?"Speakingâ€¦":"Hear summary"})]}),e.jsx("p",{className:"summary",children:tt}),N.length>0&&Ze.some(Boolean)&&e.jsxs("div",{className:"complete-transcripts",children:[e.jsx("h3",{children:"What you said"}),N.map((s,d)=>e.jsxs("div",{className:"complete-transcript-block",children:[e.jsxs("p",{className:"complete-transcript-question",children:[d+1,". ",s.question]}),e.jsx("p",{className:"complete-transcript-answer",children:Ze[d]||"â€”"})]},d))]}),e.jsxs("div",{className:"complete-actions",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:ps,children:"Back to home"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:fs,children:"Practice another subject"})]})]})]}),e.jsx("footer",{className:"footer",children:N.length>0&&X&&r!=="complete"&&e.jsxs("span",{children:["Question ",R+1," of ",N.length]})}),e.jsxs("div",{className:"modal",hidden:!ee.open,children:[e.jsx("div",{className:"modal-backdrop",onClick:de}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("input",{type:"text",className:"modal-title-input",placeholder:"Note title",value:ee.title,onChange:s=>ie(d=>({...d,title:s.target.value}))}),e.jsx("button",{type:"button",className:"modal-close",onClick:de,children:"Ã—"})]}),e.jsx("textarea",{className:"modal-body",rows:12,placeholder:"Write your noteâ€¦",value:ee.content,onChange:s=>ie(d=>({...d,content:s.target.value}))}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs("label",{className:"setting",children:[e.jsx("span",{children:"Subfolder"}),e.jsx("input",{type:"text",placeholder:"e.g. Lecture notes",value:ee.subfolder,onChange:s=>ie(d=>({...d,subfolder:s.target.value}))})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>k&&xs(k),children:"Delete"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:ys,children:"Save"})]})]})]})]}),e.jsx(Ws,{open:zt,onClose:()=>rt(!1),newSubfolderName:Gt,setNewSubfolderName:ct,folderSubject:x,addItem:je,onCreated:()=>dt(s=>s+1)}),e.jsx(Ks,{open:Wt,onClose:()=>it(!1),newFolderName:Kt,setNewFolderName:Yt,loadStorage:q,saveStorage:G,STORAGE_KEYS:f,openFolder:Ae}),e.jsx(Qs,{open:Qt,onClose:()=>(Ue(!1),me(null)),pendingFiles:B,librarySubjects:v,libraryAddFilesFolder:fe,setLibraryAddFilesFolder:Jt,onConfirm:async()=>{if(!(!(fe!=null&&fe.trim())||!(B!=null&&B.length))){for(const s of B){if(s.size>10*1024*1024){window.alert(`"${s.name}" is too large (max 10 MB).`);continue}const d=await Ft(s);await je({subject:fe.trim(),name:s.name,type:"file",content:d,mimeType:s.type||"application/octet-stream",size:s.size})}me(null),Ue(!1),l(s=>s)}}}),e.jsx(Js,{open:Xt,onClose:()=>qe(!1),libraryNewNote:Ne,setLibraryNewNote:lt,librarySubjects:v,onSave:async()=>{var g,E;const s=(g=Ne.folder)==null?void 0:g.trim(),d=(E=Ne.title)==null?void 0:E.trim();if(!s||!d){window.alert("Please choose a folder and enter a title.");return}await je({subject:s,name:d,type:"note",content:Ne.content||"",subfolder:""}),qe(!1),lt({folder:"",title:"",content:""}),l(U=>U)}}),e.jsx(Ys,{open:De!=null,topicKey:De,displayName:mt,setDisplayName:Me,isBuiltIn:ht,onSave:async()=>{const s=De,d=(mt||"").trim();if(ht){const U={...F};d&&d!==s?U[s]=d:delete U[s],ut(U),G(f.subjectRenames,U),se(null);return}if(!d){window.alert("Please enter a name.");return}if(d===s){se(null);return}const g=q(f.customSubjects,[])||[];if(!g.includes(s)){se(null);return}G(f.customSubjects,g.map(U=>U===s?d:U));const E=await Oe(s);for(const U of E)await We(U.id,{subject:d});Q(U=>U.map(kt=>kt===s?d:kt)),se(null)},onClose:()=>se(null),escapeHtml:W})]}):e.jsx("div",{className:"app screen-auth",children:e.jsxs("div",{className:"auth-card",children:[e.jsx("h1",{className:"logo",style:{marginBottom:"1rem"},children:"Vox Scholar"}),e.jsx("p",{className:"auth-message",children:"Server unavailable. Check your connection and try again."})]})}):e.jsx("div",{className:"app",style:{justifyContent:"center",alignItems:"center"},children:e.jsx("p",{children:"Loadingâ€¦"})})}function Ft(t){return new Promise((a,n)=>{const o=new FileReader;o.onload=()=>a(o.result),o.onerror=()=>n(o.error),o.readAsArrayBuffer(t)})}function zs({librarySubjects:t,setLibrarySubjects:a,subjectRenames:n,openFolder:o,setLibraryPendingFiles:i,setLibraryAddFilesModalOpen:l,setLibraryNewNoteModalOpen:r,setNewFolderModalOpen:u,navigate:j,getUniqueSubjects:y,getAllBySubject:m,loadStorage:b,saveStorage:w,STORAGE_KEYS:C,escapeHtml:N,QUESTIONS_BY_TOPIC:T,onRenameSubject:_}){const[I,R]=c.useState([]);return c.useEffect(()=>{if(t.length===0){R([]);return}Promise.all(t.map(async h=>{const x=await m(h),$=x.filter(z=>z.type==="note").length,L=x.filter(z=>z.type!=="note").length;return{subject:h,notes:$,files:L}})).then(R)},[t,m]),e.jsxs("section",{className:"screen screen-library active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>j("home"),children:"â† Home"}),e.jsx("h2",{className:"screen-title",children:"Library"})]}),e.jsxs("div",{className:"library-actions",children:[e.jsxs("label",{className:"btn btn-primary btn-sm library-upload-label",children:["Add files from computer",e.jsx("input",{type:"file",multiple:!0,hidden:!0,onChange:h=>{const x=h.target.files;if(x!=null&&x.length){if(t.length===0){window.alert("Create a class first (use + New class), then add files."),h.target.value="";return}i(Array.from(x)),l(!0),h.target.value=""}}})]}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>{if(t.length===0){window.alert("Create a class first (use + New class), then add notes.");return}r(!0)},children:"+ New note"}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>u(!0),children:"+ New class"})]}),e.jsx("div",{className:"library-list",children:I.length===0?e.jsx("p",{className:"library-empty",children:"No classes yet. Create a class to add notes and PDFs."}):e.jsx("ul",{className:"library-folders",children:I.map(h=>e.jsxs("li",{className:"library-folder-item",children:[e.jsxs("div",{className:"library-folder-info",children:[e.jsx("span",{className:"library-folder-name",children:N(n[h.subject]||h.subject)}),e.jsxs("span",{className:"library-folder-meta",children:[h.notes," note",h.notes!==1?"s":"",", ",h.files," file",h.files!==1?"s":""]})]}),e.jsxs("div",{className:"library-folder-actions",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-rename",onClick:()=>_(h.subject),title:T[h.subject]?"Rename display name":"Rename class",children:"Rename"}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>o(h.subject,"library"),children:"Open"})]})]},h.subject))})})]})}function Gs({folderSubject:t,subjectRenames:a,folderSubfolderFilter:n,setFolderSubfolderFilter:o,folderBackRoute:i,navigate:l,openNoteEditor:r,openFolder:u,selectTopic:j,getAllBySubject:y,getSubfolders:m,getItem:b,addItem:w,updateItem:C,deleteItem:N,setSubfolderModalOpen:T,setNewSubfolderName:_,escapeHtml:I,setRoute:R}){const[h,x]=c.useState([]),[$,L]=c.useState([]);c.useEffect(()=>{t&&(m(t).then(L),y(t).then(p=>x(p)))},[t,n,y,m]);const Y=[...n?h.filter(p=>(p.subfolder||"")===n):h].sort((p,v)=>new Date(v.updatedAt||v.createdAt)-new Date(p.updatedAt||p.createdAt)),S=async p=>{const v=await b(p);if(v)if(v.type==="note")r(p);else{const Q=v.content instanceof Blob?v.content:new Blob([v.content],{type:v.mimeType||"application/octet-stream"}),B=document.createElement("a");B.href=URL.createObjectURL(Q),B.download=v.name,B.click(),URL.revokeObjectURL(B.href)}},k=async p=>{for(const v of p){if(v.size>10*1024*1024){window.alert(`"${v.name}" is too large (max 10 MB).`);continue}const Q=await Ft(v);await w({subject:t,name:v.name,type:"file",content:Q,mimeType:v.type||"application/octet-stream",size:v.size})}y(t).then(x)};return e.jsxs("section",{className:"screen screen-folder active",children:[e.jsxs("div",{className:"screen-header",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:()=>l(i),children:"â† Back"}),e.jsxs("h2",{className:"screen-title",children:[a[t]||t," â€” Notes & files"]})]}),e.jsxs("div",{className:"folder-toolbar",children:[e.jsxs("div",{className:"folder-filter",children:[e.jsx("label",{htmlFor:"folderSubfolder",children:"Subfolder"}),e.jsxs("select",{id:"folderSubfolder",value:n,onChange:p=>o(p.target.value),children:[e.jsx("option",{value:"",children:"All"}),$.map(p=>e.jsx("option",{value:p,children:I(p)},p))]})]}),e.jsx("button",{type:"button",className:"btn btn-secondary btn-sm",onClick:()=>(_(""),T(!0)),children:"+ New subfolder"})]}),e.jsxs("div",{className:"folder-actions",children:[e.jsx("button",{type:"button",className:"btn btn-primary btn-sm",onClick:()=>r(null),children:"+ Add note"}),e.jsxs("label",{className:"btn btn-secondary btn-sm folder-upload",children:["+ Upload file",e.jsx("input",{type:"file",multiple:!0,hidden:!0,onChange:p=>{var v;(v=p.target.files)!=null&&v.length&&k(Array.from(p.target.files)),p.target.value=""}})]})]}),e.jsx("div",{className:"folder-list",children:Y.length===0?e.jsx("p",{className:"folder-empty",children:"No notes or files yet. Add a note or upload a file."}):e.jsx("ul",{className:"folder-items",children:Y.map(p=>e.jsxs("li",{className:"folder-item",children:[e.jsx("span",{className:"folder-item-icon",children:p.type==="note"?"ðŸ“":"ðŸ“Ž"}),e.jsxs("div",{className:"folder-item-info",children:[e.jsx("span",{className:"folder-item-name",children:I(p.name)}),p.subfolder&&e.jsx("span",{className:"folder-item-sub",children:I(p.subfolder)})]}),e.jsxs("div",{className:"folder-item-actions",children:[e.jsx("button",{type:"button",className:"btn-icon",title:"Edit",onClick:()=>r(p.id),children:"âœŽ"}),e.jsx("button",{type:"button",className:"btn-icon",title:"Open",onClick:()=>S(p.id),children:"â†’"}),e.jsx("button",{type:"button",className:"btn-icon btn-icon-danger",title:"Delete",onClick:()=>window.confirm("Delete this item?")&&N(p.id).then(()=>y(t).then(x)),children:"Ã—"})]})]},p.id))})}),e.jsx("div",{className:"folder-practice",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>j(t),children:"Practice this subject"})})]})}function Ws({open:t,onClose:a,newSubfolderName:n,setNewSubfolderName:o,folderSubject:i,addItem:l,onCreated:r}){const u=async()=>{const j=n.trim();j&&(await l({subject:i,name:"New note",type:"note",content:"",subfolder:j}),o(""),a(),r==null||r())};return e.jsxs("div",{className:"modal modal-sm",hidden:!t,children:[e.jsx("div",{className:"modal-backdrop",onClick:a}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:"New subfolder"}),e.jsx("button",{type:"button",className:"modal-close",onClick:a,children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("label",{children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:n,onChange:j=>o(j.target.value),placeholder:"e.g. Lecture notes, Flashcards"})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:u,children:"Create"})})]})]})}function Ks({open:t,onClose:a,newFolderName:n,setNewFolderName:o,loadStorage:i,saveStorage:l,STORAGE_KEYS:r,openFolder:u}){const j=()=>{const y=n.trim();if(!y)return;const m=i(r.customSubjects,[])||[];m.includes(y)||l(r.customSubjects,[...m,y]),o(""),a(),u(y,"library")};return e.jsxs("div",{className:"modal modal-sm",hidden:!t,children:[e.jsx("div",{className:"modal-backdrop",onClick:a}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:"New class"}),e.jsx("button",{type:"button",className:"modal-close",onClick:a,children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("label",{children:[e.jsx("span",{children:"Class name"}),e.jsx("input",{type:"text",value:n,onChange:y=>o(y.target.value),placeholder:"e.g. Cardiorespiratory, Pharmacology"})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:j,children:"Create"})})]})]})}function Ys({open:t,topicKey:a,displayName:n,setDisplayName:o,isBuiltIn:i,onSave:l,onClose:r,escapeHtml:u}){return!t||!a?null:e.jsxs("div",{className:"modal modal-sm",hidden:!t,children:[e.jsx("div",{className:"modal-backdrop",onClick:r}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:i?"Rename subject":"Rename class"}),e.jsx("button",{type:"button",className:"modal-close",onClick:r,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{className:"modal-hint",children:i?`Display name for "${u(a)}"`:`New name for "${u(a)}" (notes and files will move to the new name)`}),e.jsxs("label",{children:[e.jsx("span",{children:"Name"}),e.jsx("input",{type:"text",value:n,onChange:j=>o(j.target.value),placeholder:a})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:l,children:"Save"})]})]})]})}function Qs({open:t,onClose:a,pendingFiles:n,librarySubjects:o,libraryAddFilesFolder:i,setLibraryAddFilesFolder:l,onConfirm:r}){return e.jsxs("div",{className:"modal modal-sm",hidden:!t,children:[e.jsx("div",{className:"modal-backdrop",onClick:a}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:"Add files to class"}),e.jsx("button",{type:"button",className:"modal-close",onClick:a,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"library-add-files-count",children:[(n==null?void 0:n.length)??0," file",((n==null?void 0:n.length)??0)!==1?"s":""," selected. Choose a class to add them to."]}),e.jsxs("label",{children:[e.jsx("span",{children:"Class"}),e.jsxs("select",{value:i,onChange:u=>l(u.target.value),children:[e.jsx("option",{value:"",children:"â€” Choose a class â€”"}),o.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:r,children:"Add here"})})]})]})}function Js({open:t,onClose:a,libraryNewNote:n,setLibraryNewNote:o,librarySubjects:i,onSave:l}){return e.jsxs("div",{className:"modal",hidden:!t,children:[e.jsx("div",{className:"modal-backdrop",onClick:a}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"modal-title",children:"New note"}),e.jsx("button",{type:"button",className:"modal-close",onClick:a,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("label",{children:[e.jsx("span",{children:"Class"}),e.jsxs("select",{value:n.folder,onChange:r=>o(u=>({...u,folder:r.target.value})),children:[e.jsx("option",{value:"",children:"â€” Choose a class â€”"}),i.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Title"}),e.jsx("input",{type:"text",value:n.title,onChange:r=>o(u=>({...u,title:r.target.value})),placeholder:"Note title"})]}),e.jsxs("label",{children:[e.jsx("span",{children:"Content"}),e.jsx("textarea",{rows:8,value:n.content,onChange:r=>o(u=>({...u,content:r.target.value})),placeholder:"Write your noteâ€¦"})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:l,children:"Save note"})})]})]})}export{Zs as default};
